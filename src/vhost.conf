<VirtualHost @listen_addr@:80>

	# Where's the project direcotry?
	DocumentRoot "@doc_root@"

	# Primary site URL
	ServerName "@server_name@"

	# Which file should be run by default.
	DirectoryIndex index.php

	# Disable .htaccess to boost server performance.
	<Directory "@doc_root@">
		AllowOverride None
	</Directory>

	# URL rewriting is used to redirect all requests to index.php so that the CMS handles routing.
	RewriteEngine On

	# Force all /cms requests to go via HTTPS
	RewriteRule ^/cms/(.*) https://%{SERVER_NAME}/cms/$1 [R,L]

	RewriteCond %{REQUEST_URI} !(^/index.php|^/media/)
	RewriteCond %{DOCUMENT_ROOT}/application/media%{REQUEST_FILENAME} !-f
	RewriteCond %{DOCUMENT_ROOT}/application/media%{REQUEST_FILENAME} !-d
	RewriteRule ^(.*)/$ $1 [L,R]

	RewriteCond %{REQUEST_URI} !(^/index.php|^/media/)
	RewriteCond %{DOCUMENT_ROOT}/application/media%{REQUEST_FILENAME} !-f
	RewriteCond %{DOCUMENT_ROOT}/application/media%{REQUEST_FILENAME} !-d
	RewriteRule ^(.*)$ /index.php/$1 [PT,L]

    RewriteCond %{DOCUMENT_ROOT}/application/media%{REQUEST_FILENAME} -f
    RewriteRule ^(.*)$ /site$1 [PT,L]	

	# Location of the CSS, JS, and IMG files. This makes JS and CSS from all modules available via /media/<module-name>
	AliasMatch ^/media/site/(.*)$				%{DOCUMENT_ROOT}/application/media/$1
	AliasMatch ^/media/([^/]+)/(.*)$			%{DOCUMENT_ROOT}/modules/$1/media/$1/$2

	# Which environment to use.
	# Environment should be development, staging, or production; see the sledge userguide page on environments.
	SetEnv KOHANA_ENV @environment@
</VirtualHost>

<VirtualHost @listen_addr@:443>

	# Where's the project direcotry?
	DocumentRoot "@doc_root@"

	# Primary site URL
	ServerName "@server_name@"

	# Which file should be run by default.
	DirectoryIndex index.php

	# Disable .htaccess to boost server performance.
	<Directory "@doc_root@">
		AllowOverride None
	</Directory>

	# URL rewriting is used to redirect all requests to index.php so that the CMS handles routing.
	RewriteEngine On

	RewriteCond %{REQUEST_URI} !(^/index.php|^/media/)
	RewriteCond %{DOCUMENT_ROOT}%{REQUEST_FILENAME} !-f
	RewriteCond %{DOCUMENT_ROOT}%{REQUEST_FILENAME} !-d
	RewriteRule ^(.*)/$ $1 [L,R]

	RewriteCond %{REQUEST_URI} !(^/index.php|^/media/)
	RewriteCond %{DOCUMENT_ROOT}%{REQUEST_FILENAME} !-f
	RewriteCond %{DOCUMENT_ROOT}%{REQUEST_FILENAME} !-d
	RewriteRule ^(.*)$ /index.php/$1 [PT,L]

	# Location of the sledge static files directory
	AliasMatch ^/media/site/(.*)$				%{DOCUMENT_ROOT}/application/media/$1
	AliasMatch ^/media/([^/]+)/(.*)$			%{DOCUMENT_ROOT}/modules/$1/media/$1/$2

	# Which environment to use.
	# Environment should be development, staging, or production; see the sledge userguide page on environments.
	SetEnv KOHANA_ENV @environment@
</VirtualHost>