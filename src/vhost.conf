<VirtualHost @listen_addr@:80>

	# Where's the project direcotry?
	DocumentRoot "@doc_root@"

	# Primary site URL
	ServerName "@server_name@"

	# Which file should be run by default.
	DirectoryIndex index.php

	# Disable .htaccess to boost server performance.
	<Directory "@doc_root@">
		AllowOverride None
	</Directory>

	# URL rewriting is used to redirect all requests to index.php so that the CMS handles routing.
	RewriteEngine On

	# Force all /cms requests to go via HTTPS
	RewriteRule ^/cms/(.*) https://%{SERVER_NAME}/cms/$1 [R,L]

	RewriteCond %{REQUEST_URI} !(^/index.php|^/sledge/|^/css/|^/img/|^/js/|^/site/)
	RewriteCond %{DOCUMENT_ROOT}/application/static%{REQUEST_FILENAME} !-f
	RewriteCond %{DOCUMENT_ROOT}/application/static%{REQUEST_FILENAME} !-d
	RewriteRule ^(.*)/$ $1 [L,R]

	RewriteCond %{REQUEST_URI} !(^/index.php|^/sledge/|^/css/|^/img/|^/js/|^/site/)
	RewriteCond %{DOCUMENT_ROOT}/application/static%{REQUEST_FILENAME} !-f
	RewriteCond %{DOCUMENT_ROOT}/application/static%{REQUEST_FILENAME} !-d
	RewriteRule ^(.*)$ /index.php/$1 [PT,L]

    RewriteCond %{DOCUMENT_ROOT}/application/static%{REQUEST_FILENAME} -f
    RewriteRule ^(.*)$ /site$1 [PT,L]	

	# Location of the sledge static files directory
	AliasMatch ^/sledge/(.*)$		@doc_root@/modules/sledge/static/cms/$1

	# Location of the site css directory. This is legacy, css should be accessed via /site/css in future.
	AliasMatch ^/css/(.*)$			@doc_root@/application/static/css/$1

	# Location of the site img directory. This is legacy, images should be accessed via /site/img in future.
	AliasMatch ^/img/(.*)			@doc_root@/application/static/img/$1

	# Location of the site js directory. This is legacy, javascript should be accessed via /site/js in future.
	AliasMatch ^/js/(.*)			@doc_root@/application/static/js/$1

	# Location of the site static files.
	AliasMatch ^/site/(.*)			@doc_root@/application/static/$1

	# Which environment to use.
	# Environment should be development, staging, or production; see the sledge userguide page on environments.
	SetEnv KOHANA_ENV @environment@
</VirtualHost>

<VirtualHost @listen_addr@:443>

	# Where's the project direcotry?
	DocumentRoot "@doc_root@"

	# Primary site URL
	ServerName "@server_name@"

	# Which file should be run by default.
	DirectoryIndex index.php

	# Disable .htaccess to boost server performance.
	<Directory "@doc_root@">
		AllowOverride None
	</Directory>

	# URL rewriting is used to redirect all requests to index.php so that the CMS handles routing.
	RewriteEngine On

	RewriteCond %{REQUEST_URI} !(^/index.php|^/sledge/|^/css/|^/img/|^/js/|^/site/)
	RewriteCond %{DOCUMENT_ROOT}%{REQUEST_FILENAME} !-f
	RewriteCond %{DOCUMENT_ROOT}%{REQUEST_FILENAME} !-d
	RewriteRule ^(.*)/$ $1 [L,R]

	RewriteCond %{REQUEST_URI} !(^/index.php|^/sledge/|^/css/|^/img/|^/js/|^/site/)
	RewriteCond %{DOCUMENT_ROOT}%{REQUEST_FILENAME} !-f
	RewriteCond %{DOCUMENT_ROOT}%{REQUEST_FILENAME} !-d
	RewriteRule ^(.*)$ /index.php/$1 [PT,L]

	# Location of the sledge static files directory
	AliasMatch ^/sledge/(.*)$		@doc_root@/modules/sledge/static/cms/$1

	# Location of the site css directory. This is legacy, css should be accessed via /site/css in future.
	AliasMatch ^/css/(.*)$			@doc_root@/application/static/css/$1

	# Location of the site img directory. This is legacy, images should be accessed via /site/img in future.
	AliasMatch ^/img/(.*)			@doc_root@/application/static/img/$1

	# Location of the site js directory. This is legacy, javascript should be accessed via /site/js in future.
	AliasMatch ^/js/(.*)			@doc_root@/application/static/js/$1

	# Location of the site static files.
	AliasMatch ^/site/(.*)			@doc_root@/application/static/$1

	# Which environment to use.
	# Environment should be development, staging, or production; see the sledge userguide page on environments.
	SetEnv KOHANA_ENV @environment@
</VirtualHost>