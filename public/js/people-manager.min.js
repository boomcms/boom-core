/*! boom-core - v9.0.1 (2021-01-20) */

!function(i,t,o){"use strict";o.PeopleManager=t.View.extend({el:"body",events:{"submit #b-groups-new":"createGroup"},initialize:function(e){this.$groupList=this.$("#b-groups-list"),this.$content=this.$("#b-people-content"),this.groups=new o.Collections.Groups(e.groups),this.people=new o.Collections.People(e.people),this.sites=new o.Collections.Sites(e.sites),this.listenTo(this.groups,"edit",this.editGroup),this.listenTo(this.groups,"add",this.addGroup),this.listenTo(this.groups,"sort",this.renderGroups),this.listenTo(this.people,"edit",this.editPerson),this.listenTo(this.people,"filter",this.showPeopleTable),this.renderGroups(),this.router=new o.PeopleManager.Router({groups:this.groups,people:this.people}),t.history.start()},addGroup:function(e){var t=new o.PeopleManager.GroupListItem({model:e});this.$groupList.append(t.render().el)},createGroup:function(e){e.preventDefault();var t=this.router,o=i(e.target).find("input[type=text]"),s=this.groups.create({name:o.val()},{success:function(){t.navigate("group/"+s.getId()+"/edit",{trigger:!0})}});o.val("")},editPerson:function(e){var t=new o.PeopleManager.PersonView({model:e,groups:this.groups,sites:this.sites,people:this.people});this.show(t)},editGroup:function(e){var t=new o.PeopleManager.GroupView({model:e});this.show(t)},renderGroups:function(){return this.$groupList.empty(),this.groups.each(this.addGroup,this),this},show:function(e){this.$content.html(e.render().el)},showPeopleTable:function(e){var t=new o.PeopleManager.PeopleTable({people:this.people,groups:this.groups,group:e});this.show(t)},viewGroup:function(e){this.people.trigger("filter",e),this.$content.html(this.$peopleTable)}})}(jQuery,Backbone,BoomCMS),function(e,t,o){"use strict";o.PeopleManager.GroupListItem=t.View.extend({tagName:"li",template:_.template(e("#b-group-list-item").html()),events:{"click .delete":"deleteGroup"},initialize:function(){this.listenTo(this.model,"change",this.render),this.listenTo(this.model,"change",this.sortGroups),this.listenTo(this.model,"destroy",this.remove)},render:function(){return this.$el.html(this.template(this.model.toJSON())),this},deleteGroup:function(e){e.preventDefault();var t=this.model;o.Confirmation("Please confirm","Are you sure you want to remove this group? <br /><br /> This will delete the group from the database and cannot be undone!").done(function(){t.destroy()})},sortGroups:function(){this.model.collection.sort()}})}(jQuery,Backbone,BoomCMS),function(e,t){"use strict";BoomCMS.PeopleManager.GroupView=t.View.extend({tagName:"div",template:_.template(e("#b-group-edit").html()),events:{"blur h2":"save"},render:function(){return this.$el.html(this.template(this.model.toJSON())),this.$name=this.$("h2").boomcmsEditableHeading(),this.$("#b-group-roles").groupPermissionsEditor({group:this.model}),this},save:function(e){e.preventDefault(),this.model.set("name",this.$name.text()).save()}})}(jQuery,Backbone),function(e,s,o){"use strict";o.PeopleManager.PeopleTable=s.View.extend({tagName:"div",template:_.template(e("#b-people-table").html()),events:{"submit #b-people-create":"processCreatePersonForm"},initialize:function(e){this.people=e.people,this.groups=e.groups,this.group=e.group,this.listenTo(this.people,"change add",this.render),this.listenTo(this.groups,"add",this.render)},addPersonToGroups:function(e,t){for(var o in t)e.addGroup(this.groups.get(t[o]));e.trigger("change")},createPerson:function(){var e=this,t=this.$("form"),o=this.people.create({name:t.find("input[name=name]").val(),email:t.find("input[name=email]").val()},{success:function(){e.addPersonToGroups(o,t.find("select").val())}})},addPersonToTable:function(e){var t=new o.PeopleManager.PeopleTableItem({model:e}).render().$el;this.$("tbody").append(t)},processCreatePersonForm:function(e){e.preventDefault();var t=this.$("form"),o=t.find("input[name=email]").val(),s=this.people.findByEmail(o);void 0===s?this.createPerson():this.addPersonToGroups(s,t.find("select").val())},render:function(){var t=this,o=this.group;return this.$el.html(this.template({group:o,groups:this.groups,selectedGroups:new s.Collection([o])})),this.people.each(function(e){o&&!e.groups.get(o.getId())||t.addPersonToTable(e)}),this.$("select").chosen(),this.$("form").find("input[name=name]").focus(),this},sortPeople:function(){this.people.sort()}})}(jQuery,Backbone,BoomCMS),function(e,t,o){"use strict";o.PeopleManager.PeopleTableItem=t.View.extend({tagName:"tr",template:_.template(e("#b-people-table-item").html()),events:{"click .delete":"deletePerson"},deletePerson:function(e){e.preventDefault();var t=this.model;o.Confirmation("Please confirm","Are you sure you want to delete "+t.getName()+"?").done(function(){t.destroy()})},initialize:function(){this.listenTo(this.model,"change",this.render),this.listenTo(this.model,"destroy",this.remove),this.listenTo(this.model.groups,"add remove",this.render)},render:function(){return this.$el.html(this.template({person:this.model,groups:this.model.getGroups().models})).ui(),this}})}(jQuery,Backbone,BoomCMS),function(s,e){"use strict";BoomCMS.PeopleManager.PersonView=e.View.extend({tagName:"div",template:_.template(s("#b-person-view-template").html()),events:{"click #b-person-delete":"deletePerson","blur h2":"saveName","change select[name=enabled], select[name=superuser]":"toggleAttribute"},initialize:function(e){this.groups=e.groups,this.sites=e.sites,this.people=e.people,this.listenTo(this.model,"destroy",this.remove)},deletePerson:function(){this.model.destroy()},render:function(){var o=this.model,s=this.groups,i=this.sites;return this.$el.html(this.template({person:o,groups:s,selectedGroups:this.model.getGroups(),sites:i,createdBy:this.people.get(o.getCreatedBy())})).ui(),this.$name=this.$(".name").boomcmsEditableHeading(),this.$('select[name="groups[]"]').chosen().change(function(e,t){return void 0!==t.selected?o.addGroup(s.get(t.selected)):o.removeGroup(o.groups.get(t.deselected))}),this.$("select[name=sites]").chosen().change(function(e,t){return void 0!==t.selected?o.addSite(i.get(t.selected)):o.removeSite(o.sites.get(t.deselected))}),this},saveName:function(e){e.preventDefault(),this.model.set("name",this.$name.text()).save()},toggleAttribute:function(e){var t=s(e.target),o=t.find(":selected").val();this.model.set(t.attr("name"),o).save()}})}(jQuery,Backbone),function(t){"use strict";BoomCMS.PeopleManager.Router=t.Router.extend({routes:{"":"home","group/:group/edit":"editGroup","group/:group":"viewGroup","person/:person":"editPerson"},initialize:function(e){this.groups=e.groups,this.people=e.people,this.listenTo(this.people,"destroy",this.goBackOnPersonDelete)},editGroup:function(e){var t=this.groups.get(e);t.trigger("edit",t)},editPerson:function(e){var t=this.people.get(e);t.trigger("edit",t)},goBackOnPersonDelete:function(e){t.history.getFragment()==="person/"+e.getId()&&window.history.back()},home:function(){this.people.trigger("filter")},viewGroup:function(e){var t=this.groups.get(e);this.people.trigger("filter",t)}})}(Backbone);
//# sourceMappingURL=people-manager.min.js.map