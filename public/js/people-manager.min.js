/*! boom-core - v7.1.0-dev (2017-08-21) */

!function(a,b,c){"use strict";c.PeopleManager=b.View.extend({el:"body",events:{"submit #b-groups-new":"createGroup"},initialize:function(a){this.$groupList=this.$("#b-groups-list"),this.$content=this.$("#b-people-content"),this.groups=new c.Collections.Groups(a.groups),this.people=new c.Collections.People(a.people),this.sites=new c.Collections.Sites(a.sites),this.listenTo(this.groups,"edit",this.editGroup),this.listenTo(this.groups,"add",this.addGroup),this.listenTo(this.groups,"sort",this.renderGroups),this.listenTo(this.people,"edit",this.editPerson),this.listenTo(this.people,"filter",this.showPeopleTable),this.renderGroups(),this.router=new c.PeopleManager.Router({groups:this.groups,people:this.people}),b.history.start()},addGroup:function(a){var b=new c.PeopleManager.GroupListItem({model:a});this.$groupList.append(b.render().el)},createGroup:function(b){b.preventDefault();var c,d=this.router,e=a(b.target).find("input[type=text]");c=this.groups.create({name:e.val()},{success:function(){d.navigate("group/"+c.getId()+"/edit",{trigger:!0})}}),e.val("")},editPerson:function(a){var b=new c.PeopleManager.PersonView({model:a,groups:this.groups,sites:this.sites,people:this.people});this.show(b)},editGroup:function(a){var b=new c.PeopleManager.GroupView({model:a});this.show(b)},renderGroups:function(){return this.$groupList.empty(),this.groups.each(this.addGroup,this),this},show:function(a){this.$content.html(a.render().el)},showPeopleTable:function(a){var b=new c.PeopleManager.PeopleTable({people:this.people,groups:this.groups,group:a});this.show(b)},viewGroup:function(a){this.people.trigger("filter",a),this.$content.html(this.$peopleTable)}})}(jQuery,Backbone,BoomCMS),function(a,b,c){"use strict";c.PeopleManager.GroupListItem=b.View.extend({tagName:"li",template:_.template(a("#b-group-list-item").html()),events:{"click .delete":"deleteGroup"},initialize:function(){this.listenTo(this.model,"change",this.render),this.listenTo(this.model,"change",this.sortGroups),this.listenTo(this.model,"destroy",this.remove)},render:function(){return this.$el.html(this.template(this.model.toJSON())),this},deleteGroup:function(a){a.preventDefault();var b=this.model;c.Confirmation("Please confirm","Are you sure you want to remove this group? <br /><br /> This will delete the group from the database and cannot be undone!").done(function(){b.destroy()})},sortGroups:function(){this.model.collection.sort()}})}(jQuery,Backbone,BoomCMS),function(a,b,c){"use strict";c.PeopleManager.GroupView=b.View.extend({tagName:"div",template:_.template(a("#b-group-edit").html()),events:{"blur h2":"save"},render:function(){return this.$el.html(this.template(this.model.toJSON())),this.$name=this.$("h2").boomcmsEditableHeading(),this.$("#b-group-roles").groupPermissionsEditor({group:this.model}),this},save:function(a){a.preventDefault(),this.model.set("name",this.$name.text()).save()}})}(jQuery,Backbone,BoomCMS),function(a,b,c){"use strict";c.PeopleManager.PeopleTable=b.View.extend({tagName:"div",template:_.template(a("#b-people-table").html()),events:{"submit #b-people-create":"processCreatePersonForm"},initialize:function(a){this.people=a.people,this.groups=a.groups,this.group=a.group,this.listenTo(this.people,"change add",this.render),this.listenTo(this.groups,"add",this.render)},addPersonToGroups:function(a,b){for(var c in b)a.addGroup(this.groups.get(b[c]));a.trigger("change")},createPerson:function(){var a=this,b=this.$("form"),c=this.people.create({name:b.find("input[name=name]").val(),email:b.find("input[name=email]").val()},{success:function(){a.addPersonToGroups(c,b.find("select").val())}})},addPersonToTable:function(a){var b=new c.PeopleManager.PeopleTableItem({model:a}),d=b.render().$el;this.$("tbody").append(d)},processCreatePersonForm:function(a){a.preventDefault();var b=this.$("form"),c=b.find("input[name=email]").val(),d=this.people.findByEmail(c);void 0===d?this.createPerson():this.addPersonToGroups(d,b.find("select").val())},render:function(){var a=this,c=this.group;return this.$el.html(this.template({group:c,groups:this.groups,selectedGroups:new b.Collection([c])})),this.people.each(function(b){c&&!b.groups.get(c.getId())||a.addPersonToTable(b)}),this.$("select").chosen(),this.$("form").find("input[name=name]").focus(),this},sortPeople:function(){this.people.sort()}})}(jQuery,Backbone,BoomCMS),function(a,b,c){"use strict";c.PeopleManager.PeopleTableItem=b.View.extend({tagName:"tr",template:_.template(a("#b-people-table-item").html()),events:{"click .delete":"deletePerson"},deletePerson:function(a){a.preventDefault();var b=this.model;c.Confirmation("Please confirm","Are you sure you want to delete "+b.getName()+"?").done(function(){b.destroy()})},initialize:function(){this.listenTo(this.model,"change",this.render),this.listenTo(this.model,"destroy",this.remove),this.listenTo(this.model.groups,"add remove",this.render)},render:function(){return this.$el.html(this.template({person:this.model,groups:this.model.getGroups().models})).ui(),this}})}(jQuery,Backbone,BoomCMS),function(a,b,c){"use strict";c.PeopleManager.PersonView=b.View.extend({tagName:"div",template:_.template(a("#b-person-view-template").html()),events:{"click #b-person-delete":"deletePerson","blur h2":"saveName","change select[name=enabled], select[name=superuser]":"toggleAttribute"},initialize:function(a){this.groups=a.groups,this.sites=a.sites,this.people=a.people,this.listenTo(this.model,"destroy",this.remove)},deletePerson:function(){this.model.destroy()},render:function(){var a=this.model,b=this.groups,c=this.sites;return this.$el.html(this.template({person:a,groups:b,selectedGroups:this.model.getGroups(),sites:c,createdBy:this.people.get(a.getCreatedBy())})).ui(),this.$name=this.$(".name").boomcmsEditableHeading(),this.$('select[name="groups[]"]').chosen().change(function(c,d){return void 0!==d.selected?a.addGroup(b.get(d.selected)):a.removeGroup(a.groups.get(d.deselected))}),this.$("select[name=sites]").chosen().change(function(b,d){return void 0!==d.selected?a.addSite(c.get(d.selected)):a.removeSite(a.sites.get(d.deselected))}),this},saveName:function(a){a.preventDefault(),this.model.set("name",this.$name.text()).save()},toggleAttribute:function(b){var c=a(b.target),d=c.find(":selected").val();this.model.set(c.attr("name"),d).save()}})}(jQuery,Backbone,BoomCMS),function(a,b){"use strict";b.PeopleManager.Router=a.Router.extend({routes:{"":"home","group/:group/edit":"editGroup","group/:group":"viewGroup","person/:person":"editPerson"},initialize:function(a){this.groups=a.groups,this.people=a.people,this.listenTo(this.people,"destroy",this.goBackOnPersonDelete)},editGroup:function(a){var b=this.groups.get(a);b.trigger("edit",b)},editPerson:function(a){var b=this.people.get(a);b.trigger("edit",b)},goBackOnPersonDelete:function(b){a.history.getFragment()==="person/"+b.getId()&&window.history.back()},home:function(){this.people.trigger("filter")},viewGroup:function(a){var b=this.groups.get(a);this.people.trigger("filter",b)}})}(Backbone,BoomCMS);
//# sourceMappingURL=people-manager.min.js.map