/*! boom-core - v5.2-Dev (2016-05-17) */

!function(a,b,c){"use strict";c.PeopleManager=b.View.extend({el:a("body"),events:{"submit #b-groups-new":"createGroup","click #b-people-create":"createPerson","click #b-people-all":"showAllPeople"},initialize:function(a){this.$groupList=this.$("#b-groups-list"),this.$content=this.$("#b-people-content"),this.groups=new c.Collections.Groups(a.groups),this.people=new c.Collections.People(a.people),this.sites=new c.Collections.Sites(a.sites),this.listenTo(this.groups,"edit",this.editGroup),this.listenTo(this.groups,"add",this.addGroup),this.listenTo(this.groups,"change:name",this.sortGroups),this.listenTo(this.groups,"all sort",this.renderGroups),this.listenTo(this.groups,"view",this.viewGroup),this.listenTo(this.people,"change:name",this.sortPeople),this.listenTo(this.people,"edit",this.editPerson),this.listenTo(this.router,"home",this.showAllPeople),this.groups.sort(),this.people.sort(),this.$peopleTable=new c.PeopleManager.PeopleTable({people:this.people}).render().$el,this.router=new c.PeopleManager.Router({groups:this.groups,people:this.people}),b.history.start()},addGroup:function(a){var b=new c.PeopleManager.GroupListItem({model:a});this.$groupList.append(b.render().el)},createGroup:function(b){b.preventDefault();var c=a(b.target).find("input[type=text]");this.groups.create({name:c.val()}),c.val("")},createPerson:function(a){a.preventDefault();var b=new c.PeopleManager.CreatePerson({groups:this.groups,people:this.people});this.show(b)},editPerson:function(a){var b=new c.PeopleManager.PersonView({model:a,groups:this.groups,sites:this.sites});this.show(b)},editGroup:function(a){var b=new c.PeopleManager.GroupView({model:a});this.show(b),b.$el.groupPermissionsEditor({group:a})},renderGroups:function(){return this.$groupList.empty(),this.groups.each(this.addGroup,this),this},show:function(a){this.$content.html(a.render().el)},showAllPeople:function(){this.people.trigger("filter",null),this.$content.html(this.$peopleTable)},sortGroups:function(){this.groups.sort()},sortPeople:function(){this.people.sort()},viewGroup:function(a){this.people.trigger("filter",a),this.$content.html(this.$peopleTable)}})}(jQuery,Backbone,BoomCMS),function(a,b,c){"use strict";c.PeopleManager.CreatePerson=b.View.extend({tagName:"div",template:_.template(a("#b-person-create-form").html()),initialize:function(a){this.groups=a.groups,this.people=a.people},events:{"click button":"createPerson"},createPerson:function(a){a.preventDefault();this.people.create(this.$("form").serializeJSON())},render:function(){return this.$el.html(this.template({groups:this.groups,selectedGroups:new c.Collections.Groups})),this.$("select").chosen(),this}})}(jQuery,Backbone,BoomCMS),function(a,b,c){"use strict";c.PeopleManager.GroupListItem=b.View.extend({tagName:"li",template:_.template(a("#b-group-list-item").html()),events:{"click .delete":"deleteGroup","click .edit":"editGroup"},initialize:function(){this.listenTo(this.model,"change",this.render),this.listenTo(this.model,"destroy",this.remove)},render:function(){return this.$el.html(this.template(this.model.toJSON())),this},deleteGroup:function(a){a.preventDefault();var b=this.model,d=c.confirm("Please confirm","Are you sure you want to remove this group? <br /><br /> This will delete the group from the database and cannot be undone!");d.done(function(){b.destroy()})},editGroup:function(a){a.preventDefault(),this.model.trigger("edit",this.model)}})}(jQuery,Backbone,BoomCMS),function(a,b,c){"use strict";c.PeopleManager.GroupView=b.View.extend({tagName:"div",template:_.template(a("#b-group-edit").html()),events:{"click #b-people-group-save":"saveGroupName","click h2, h2 + a":"editName","blur h2":"save"},editName:function(a){a.preventDefault(),this.$name.removeClass(c.editableClass).focus()},render:function(){return this.$el.html(this.template(this.model.toJSON())),this.$name=this.$("h2").addClass(c.editableClass),this},save:function(a){a.preventDefault(),this.model.set("name",this.$name.text()),this.$name.addClass(c.editableClass),this.model.save()}})}(jQuery,Backbone,BoomCMS),function(a,b,c){"use strict";c.PeopleManager.PeopleTable=b.View.extend({rows:{},tagName:"div",template:_.template(a("#b-people-table").html()),initialize:function(a){this.people=a.people,this.listenTo(this.people,"sort",this.showAllPeople),this.listenTo(this.people,"filter",this.filterPeople)},addPersonToTable:function(a){var b=new c.PeopleManager.PeopleTableItem({model:a}),d=b.render().$el;this.rows[a.getId()]=d,this.$("tbody").append(d)},filterPeople:function(a){var b,c=this;this.people.each(function(d){b=!a||d.groups.get(a.getId())?"show":"hide",c.rows[d.getId()][b]()})},render:function(){var a=this;return this.$el.html(this.template()),this.people.each(function(b){a.addPersonToTable(b)}),this}})}(jQuery,Backbone,BoomCMS),function(a,b,c){"use strict";c.PeopleManager.PeopleTableItem=b.View.extend({tagName:"tr",template:_.template(a("#b-people-table-item").html()),events:{"click .delete":"deletePerson"},deletePerson:function(a){a.preventDefault();var b=this.model;c.confirm("Please confirm","Are you sure you want to delete "+b.getName()+"?").done(function(){b.destroy()})},initialize:function(){this.listenTo(this.model,"change",this.render),this.listenTo(this.model,"destroy",this.remove),this.listenTo(this.model.groups,"add remove",this.render)},render:function(){return this.$el.html(this.template({person:this.model,groups:this.model.getGroups().models})).find("time").timeago(),this}})}(jQuery,Backbone,BoomCMS),function(a,b,c){"use strict";c.PeopleManager.PersonView=b.View.extend({tagName:"div",template:_.template(a("#b-person-view").html()),events:{"click .name, .name + a":"editName","click #b-person-delete":"deletePerson","blur h2":"saveName","change select[name=enabled], select[name=superuser]":"toggleAttribute"},initialize:function(a){this.groups=a.groups,this.sites=a.sites,this.listenTo(this.model,"destroy",this.remove)},editName:function(a){a.preventDefault(),this.$name.removeClass(c.editableClass).focus()},deletePerson:function(){this.model.destroy()},render:function(){var a=this.model,b=this.groups,d=this.sites;return this.$el.html(this.template({person:a,groups:b,selectedGroups:this.model.getGroups(),sites:d})),this.$name=this.$(".name").addClass(c.editableClass),this.$('select[name="groups[]"]').chosen().change(function(c,d){return"undefined"!=typeof d.selected?a.addGroup(b.get(d.selected)):a.removeGroup(a.groups.get(d.deselected))}),this.$("select[name=sites]").chosen().change(function(b,c){return"undefined"!=typeof c.selected?a.addSite(d.get(c.selected)):a.removeSite(a.sites.get(c.deselected))}),this},saveName:function(a){a.preventDefault(),this.model.set("name",this.$name.text()),this.$name.addClass(c.editableClass),this.model.save()},toggleAttribute:function(b){var c=a(b.target),d=c.find(":selected").val();this.model.set(c.attr("name"),d).save()}})}(jQuery,Backbone,BoomCMS),function(a,b,c){"use strict";c.PeopleManager.Router=b.Router.extend({routes:{"":"home","group/:group/edit":"editGroup","group/:group":"viewGroup","person/:person":"editPerson"},initialize:function(a){this.groups=a.groups,this.people=a.people,this.listenTo(this.groups,"change:id",this.editGroupOnCreate),this.listenTo(this.people,"destroy",this.goBackOnPersonDelete)},editGroup:function(a){var b=this.groups.get(a);b.trigger("edit",b)},editGroupOnCreate:function(a){this.navigate("group/"+a.getId()+"/edit"),a.trigger("edit",a)},editPerson:function(a){var b=this.people.get(a);b.trigger("edit",b)},goBackOnPersonDelete:function(a){b.history.getFragment()==="person/"+a.getId()&&window.history.back()},home:function(){this.trigger("home")},viewGroup:function(a){var b=this.groups.get(a);b.trigger("view",b)}})}(jQuery,Backbone,BoomCMS);
//# sourceMappingURL=people-manager.min.js.map